<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UTR Number Collection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: white;
    }

    .winning-number-box {
      width: 200px;
      height: 200px;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 40px;
      font-size: 60px;
      font-weight: bold;
      color: transparent;
      border-radius: 10px;
      border: 2px solid #ff006e;
      box-shadow: 0 0 20px 5px #ff006e, 0 0 30px 5px #ff006e;
      animation: blink 1.5s infinite alternate;
    }

    .winning-number {
      color: #ff006e;
      text-shadow: 0 0 10px #ff006e, 0 0 20px #ff006e, 0 0 30px #ff006e;
    }

    .winner-name-box {
      font-size: 18px;
      margin-top: 10px;
      font-weight: normal;
      color: white;
    }

    .timer-box {
      text-align: center;
      margin-top: 10px;
      font-size: 20px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 10px;
    }

    @keyframes blink {
      0% {
        text-shadow: 0 0 10px #ff006e, 0 0 20px #ff006e, 0 0 30px #ff006e;
        opacity: 1;
      }
      100% {
        text-shadow: 0 0 20px #ff006e, 0 0 30px #ff006e, 0 0 40px #ff006e;
        opacity: 0.5;
      }
    }

    .number-container {
      display: flex;
      gap: 10px;
      margin: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .number-btn {
      background: white;
      color: #2575fc;
      font-size: 18px;
      font-weight: bold;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #buyForm {
      display: none;
      margin-top: 20px;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }

    .back-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .buy-info {
      margin-bottom: 15px;
      text-align: center;
    }

    .buy-info img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .list-btns {
      margin-top: 30px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .toggle-btn {
      background: #00ffcc;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }

    .list-btn-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .list-container {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
      max-height: 200px;
      overflow-y: auto;
      width: 150px;
      display: none;
    }

    .list-container ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .list-container li {
      background: rgba(0, 0, 0, 0.3);
      margin: 5px 0;
      padding: 5px;
      border-radius: 5px;
      font-size: 14px;
    }

    .loader {
      display: none;
      margin-top: 10px;
      color: red;
    }

    input[type="text"], input[type="file"] {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-weight: bold;
    }

    #uploadedImage {
      max-width: 100%;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="winning-number-box">
    <div class="winning-number" id="winningNumber"></div>
  </div>

  <div class="winner-name-box" id="winnerName" style="display:none"></div>

  <div class="timer-box" id="timer">üïí Time Left: 00:03:00</div>

  <div class="number-container">
    <button class="number-btn" onclick="selectNumber('05')">05</button>
    <button class="number-btn" onclick="selectNumber('16')">16</button>
    <button class="number-btn" onclick="selectNumber('27')">27</button>
    <button class="number-btn" onclick="selectNumber('38')">38</button>
    <button class="number-btn" onclick="selectNumber('49')">49</button>
  </div>

  <div id="buyForm">
    <button class="back-btn" onclick="goBack()">‚Üê Back</button>

    <div class="buy-info">
      <img src="https://vault.pictures/media/images/b9/0e/a8/b90ea8a2240645509bb68a7ba006940c.jpg" alt="Payment Info" />
      <p>Please make the payment and upload the screenshot. Then fill in your details below.</p>
    </div>

    <h3>Buy Form</h3>
    <p>Selected Number: <span id="selectedNumber"></span></p>
    <input type="text" id="whatsappInput" placeholder="Enter WhatsApp Number" />
    <input type="text" id="nameInput" placeholder="Enter Full Name" />
    <input type="text" id="phonepeInput" placeholder="Enter PhonePe Number" />
    <input type="text" id="utrInput" placeholder="UTR Number (Auto)" readonly />
    <div id="utrTimestamp"></div>
    <input type="file" id="imageUpload" accept="image/*" onchange="extractUTRFromImage()" />
    <button onclick="submitForm()">Submit</button>
    <div id="loader" class="loader">Detecting UTR Number...</div>
    <img id="uploadedImage" src="" alt="Uploaded Image" />
  </div>

  <div class="list-btns">
    <button class="toggle-btn" onclick="toggleList('buyersList')">Buyers List</button>
    <button class="toggle-btn" onclick="toggleList('winnersList')">Winners List</button>
  </div>

  <div class="list-btn-container">
    <div class="list-container" id="buyersList">
      <ul id="buyers">
        <li>Ravi - 05</li>
        <li>Priya - 16</li>
      </ul>
    </div>
    <div class="list-container" id="winnersList">
      <ul id="winners">
        <li>Alice - 27</li>
      </ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <script>
    const telegramToken = "YOUR_TELEGRAM_BOT_TOKEN";
    const telegramChatId = "YOUR_TELEGRAM_CHAT_ID";

    const winningNumberValue = "16";
    const winnerNameValue = "Alice";

    document.getElementById("winningNumber").textContent = "";
    document.getElementById("winnerName").style.display = "none";

    let timeInSeconds = 120;
    function updateTimer() {
      const timerDisplay = document.getElementById("timer");
      const minutes = String(Math.floor(timeInSeconds / 60)).padStart(2, '0');
      const seconds = String(timeInSeconds % 60).padStart(2, '0');
      timerDisplay.textContent = `üïí Time Left: ${minutes}:${seconds}`;

      if (timeInSeconds === 0) {
        clearInterval(timerInterval);
        document.getElementById("winningNumber").textContent = winningNumberValue;
        document.getElementById("winnerName").textContent = `üèÜ Winner: ${winnerNameValue}`;
        document.getElementById("winnerName").style.display = "block";
      } else {
        timeInSeconds--;
      }
    }
    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer();

    function selectNumber(num) {
      document.getElementById('selectedNumber').textContent = num;
      document.getElementById('buyForm').style.display = 'block';
      document.querySelector('.number-container').style.display = 'none';
    }

    function goBack() {
      document.getElementById('buyForm').style.display = 'none';
      document.querySelector('.number-container').style.display = 'flex';
    }

    function toggleList(id) {
      const list = document.getElementById(id);
      list.style.display = list.style.display === 'none' ? 'block' : 'none';
    }

    function extractUTRFromImage() {
      const imageInput = document.getElementById('imageUpload');
      const utrInput = document.getElementById('utrInput');
      const timestamp = document.getElementById('utrTimestamp');
      const loader = document.getElementById('loader');

      const file = imageInput.files[0];
      if (!file) return;

      loader.style.display = 'block';

      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        document.getElementById('uploadedImage').style.display = 'none';

        Tesseract.recognize(
          imageData, 'eng',
          { logger: m => console.log(m) }
        ).then(({ data: { text } }) => {
          const match = text.match(/\b\d{10,14}\b/);
          if (match) {
            const utr = match[0];
            utrInput.value = utr;
            const now = new Date();
            timestamp.textContent = "Collected at: " + now.toLocaleTimeString();
          } else {
            alert("No valid UTR number found in the image.");
          }
        }).catch(err => {
          console.error(err);
          alert("Error reading image.");
        }).finally(() => {
          loader.style.display = 'none';
        });
      };
      reader.readAsDataURL(file);
    }

    function submitForm() {
      const whatsapp = document.getElementById('whatsappInput').value;
      const name = document.getElementById('nameInput').value;
      const phonepe = document.getElementById('phonepeInput').value;
      const utr = document.getElementById('utrInput').value;
      const selected = document.getElementById('selectedNumber').textContent;

      if (!whatsapp || !name || !phonepe || !utr || !selected) {
        alert("Please fill all fields.");
        return;
      }

      const message = `üìù New Form Submission:\nüë§ Name: ${name}\nüì± WhatsApp: ${whatsapp}\nüí∏ PhonePe: ${phonepe}\nüéØ Selected Number: ${selected}\nüî¢ UTR: ${utr}`;

      fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: telegramChatId, text: message })
      });

      alert("Form submitted!");
    }
  </script>
</body>
</html>
