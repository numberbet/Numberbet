<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Win Go Betting Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0e0e0e;
      color: #fff;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    h1 {
      margin-top: 10px;
      font-size: 28px;
      color: #00ffcc;
    }

    .wallet-card {
      background: #2e3a75;
      border-radius: 20px;
      padding: 20px;
      width: 320px;
      color: white;
      text-align: center;
      margin: 20px auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .wallet-amount {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .wallet-label {
      font-size: 16px;
      color: #dcdcdc;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .wallet-label i {
      font-size: 20px;
    }

    .wallet-actions {
      display: flex;
      justify-content: space-around;
      gap: 20px;
    }

    .wallet-btn {
      flex: 1;
      padding: 10px 0;
      font-size: 14px;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    .wallet-btn.withdraw {
      background: #d93030;
      color: white;
    }

    .wallet-btn.deposit {
      background: #27c76b;
      color: white;
    }

    .form-container {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: #1e1e1e;
      border-radius: 15px;
      width: 90%;
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
    }

    input, button {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
    }

    input {
      background: #333;
      color: white;
    }

    .back-btn {
      background: #444;
      color: white;
    }

    img {
      width: 200px;
      margin: 10px 0;
    }

    .qr-error {
      color: #ff5555;
      font-size: 14px;
      margin: 10px 0;
    }

    .card {
      background: #1c1c1e;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      max-width: 500px;
      box-shadow: 0 0 10px #00ff99;
      position: relative;
    }

    .top-section {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .timer {
      font-size: 2em;
      padding: 10px 20px;
      background: #222;
      border-radius: 10px;
      box-shadow: 0 0 5px #0f0;
    }

    .winning-box {
      width: 60px;
      height: 60px;
      font-size: 1.5em;
      background: #444;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      box-shadow: 0 0 5px #f0f;
      color: #fff;
    }

    .number-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin: 20px 0;
    }

    .number-btn {
      width: 60px;
      height: 60px;
      font-size: 1.5em;
      font-weight: bold;
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px #fff;
      transition: transform 0.2s;
    }

    .number-btn.red {
      background: radial-gradient(circle, #ff4444 30%, #aa0000);
    }

    .number-btn.green {
      background: radial-gradient(circle, #00cc66 30%, #006633);
    }

    .number-btn.purple {
      background: radial-gradient(circle, #aa66cc 30%, #6600aa);
    }

    .number-btn.mix-red-purple {
      background: linear-gradient(to right, red 50%, violet 50%);
    }

    .number-btn.mix-green-purple {
      background: linear-gradient(to right, green 50%, violet 50%);
    }

    .number-btn.selected {
      box-shadow: 0 0 10px #ffff00, 0 0 15px #ff0;
      transform: scale(1.1);
    }

    .color-grid {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .color-btn {
      width: 100px;
      height: 50px;
      font-size: 1.2em;
      font-weight: bold;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .color-btn.green {
      background: green;
    }

    .color-btn.violet {
      background: purple;
    }

    .color-btn.red {
      background: red;
    }

    .color-btn.selected {
      box-shadow: 0 0 10px #ffff00, 0 0 15px #ff0;
      transform: scale(1.1);
    }

    .size-grid {
      display: flex;
      justify-content: center;
      gap: 0;
      margin: 20px 0;
      width: 200px;
      margin-left: auto;
      margin-right: auto;
    }

    .size-btn {
      flex: 1;
      height: 50px;
      font-size: 1.2em;
      font-weight: bold;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .size-btn.big {
      background: #ff6200;
      border-top-left-radius: 25px;
      border-bottom-left-radius: 25px;
    }

    .size-btn.small {
      background: #00c4b4;
      border-top-right-radius: 25px;
      border-bottom-right-radius: 25px;
    }

    .size-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }

    .size-btn.selected {
      box-shadow: 0 0 10px #ffff00, 0 0 15px #ff0;
      transform: scale(1.05);
    }

    #historyList li, #myBetHistoryList li {
      margin: 5px 0;
      font-size: 1.1em;
    }

    #historyList a {
      color: #00ffcc;
      text-decoration: none;
      cursor: pointer;
    }

    #historyList a:hover {
      text-decoration: underline;
    }

    .operator-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      color: #555;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .operator-panel {
      background: #2e2e2e;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      width: 90%;
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 0 5px #00ff99;
    }

    .operator-panel h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }

    .operator-panel button {
      background: #27c76b;
      color: white;
      margin: 5px 0;
    }

    .operator-panel .close-btn {
      background: #d93030;
    }

    .operator-panel ul {
      list-style: none;
      padding: 0;
      margin: 10px 0;
    }

    .operator-panel li {
      background: #444;
      padding: 5px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .operator-panel li button {
      width: auto;
      padding: 5px 10px;
      font-size: 12px;
    }

    .deposit-amounts {
      display: flex;
      justify-content: space-between;
      gap: 5px;
      margin: 10px 0;
      flex-wrap: nowrap;
    }

    .amount-btn {
      background: #27c76b;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      flex: 1;
      min-width: 60px;
    }

    .amount-btn:hover {
      background: #1ea854;
    }

    .amount-btn.selected {
      background: #1ea854;
      box-shadow: 0 0 5px #ffff00;
    }

    .history-tabs {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: 10px;
      width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      font-weight: bold;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .tab-btn.game-history {
      background: #555;
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
    }

    .tab-btn.my-bet-history {
      background: #555;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
    }

    .tab-btn.active {
      background: #00ff99;
      color: #000;
    }

    .status-message {
      font-size: 14px;
      margin: 10px 0;
    }

    .status-message.success {
      color: #00ff00;
    }

    .status-message.error {
      color: #ff5555;
    }
  </style>
</head>
<body>

  <h1>Win Go Betting Game</h1>

  <div class="wallet-card">
    <div class="wallet-amount" id="walletBalance">â‚¹0.51</div>
    <div class="wallet-label"><i>ðŸ‘›</i> Wallet Balance</div>
    <div class="wallet-actions">
      <button class="wallet-btn withdraw" onclick="showForm('withdraw')">Withdraw</button>
      <button class="wallet-btn deposit" onclick="showForm('deposit')">Deposit</button>
    </div>
  </div>

  <div id="depositForm" class="form-container">
    <h3>Deposit Top-Up</h3>
    <img id="qrCodeImage" src="https://vault.pictures/media/images/87/57/5e/87575e9fdcbf4b7db2a09533d4b49900.jpg" alt="QR Code" onerror="this.style.display='none'; document.getElementById('qrErrorMessage').style.display='block';"><br>
    <div id="qrErrorMessage" class="qr-error" style="display: none;">Failed to load QR code. Please check the image URL or host the image on a publicly accessible platform.</div>
    <p>Scan & Pay using UPI</p>
    <div class="deposit-amounts">
      <button class="amount-btn selected" onclick="selectDepositAmount(100)">â‚¹100</button>
      <button class="amount-btn" onclick="selectDepositAmount(200)">â‚¹200</button>
      <button class="amount-btn" onclick="selectDepositAmount(500)">â‚¹500</button>
      <button class="amount-btn" onclick="selectDepositAmount(1000)">â‚¹1000</button>
    </div>
    <input type="text" id="phoneNumber" placeholder="Enter Your Phone Number" required><br>
    <input type="text" id="depositUTR" placeholder="Enter UTR Number" required><br>
    <div id="depositStatus" class="status-message"></div>
    <input type="file" id="depositProof" accept="image/*" required><br>
    <button onclick="submitDeposit()">Submit</button><br>
    <button class="back-btn" onclick="hideForms()">Back</button>
  </div>

  <div id="withdrawForm" class="form-container">
    <h3>Withdraw Request</h3>
    <input type="text" id="bankName" placeholder="Bank Name" required><br>
    <input type="text" id="accountNumber" placeholder="Account Number" required><br>
    <input type="text" id="ifscCode" placeholder="IFSC Code" required><br>
    <input type="number" id="withdrawAmount" placeholder="Withdraw Amount (Min â‚¹200)" min="200" required><br>
    <button onclick="submitWithdraw()">Submit</button><br>
    <button class="back-btn" onclick="hideForms()">Back</button>
  </div>

  <div class="card">
    <h2>Period: <span id="period"></span></h2>
    <button class="operator-btn" onclick="promptOperatorPanel()">Â·</button>

    <div class="top-section">
      <div class="timer" id="countdown">60</div>
      <div class="winning-box" id="winningResult">--</div>
    </div>

    <div class="color-grid" id="colorGrid">
      <!-- Color buttons will be added here -->
    </div>

    <div class="number-grid" id="numberGrid">
      <!-- Number buttons will be added here -->
    </div>

    <div class="size-grid" id="sizeGrid">
      <!-- Big and Small buttons will be added here -->
    </div>

    <div id="betForm">
      <input type="number" id="amount" placeholder="Enter Amount (Min â‚¹10)" min="10" required><br>
      <button onclick="placeBet()">Place Bet</button>
    </div>
  </div>

  <div class="card">
    <div class="history-tabs">
      <button class="tab-btn game-history active" onclick="showGameHistory()">Game History</button>
      <button class="tab-btn my-bet-history" onclick="showMyBetHistory()">My Bet History</button>
    </div>
    <div id="gameHistorySection">
      <h2>Game History</h2>
      <ul id="historyList"></ul>
    </div>
    <div id="myBetHistorySection" style="display: none;">
      <h2>My Bet History</h2>
      <ul id="myBetHistoryList"></ul>
    </div>
  </div>

  <script>
    function showForm(type) {
      document.getElementById('depositForm').style.display = 'none';
      document.getElementById('withdrawForm').style.display = 'none';
      if (type === 'deposit') {
        document.getElementById('depositForm').style.display = 'block';
      } else {
        document.getElementById('withdrawForm').style.display = 'block';
      }
    }

    function hideForms() {
      document.getElementById('depositForm').style.display = 'none';
      document.getElementById('withdrawForm').style.display = 'none';
    }

    function showGameHistory() {
      document.getElementById('gameHistorySection').style.display = 'block';
      document.getElementById('myBetHistorySection').style.display = 'none';
      document.querySelector('.tab-btn.game-history').classList.add('active');
      document.querySelector('.tab-btn.my-bet-history').classList.remove('active');
    }

    function showMyBetHistory() {
      document.getElementById('gameHistorySection').style.display = 'none';
      document.getElementById('myBetHistorySection').style.display = 'block';
      document.querySelector('.tab-btn.game-history').classList.remove('active');
      document.querySelector('.tab-btn.my-bet-history').classList.add('active');
    }

    function showPeriodDetails(period, number, color, size) {
      alert(`Period ${period} Details:\nWinning Number: ${number}\nColor: ${color}\nSize: ${size}`);
    }

    let countdown = 60;
    let period = 20250501100030100;
    let displayPeriodNumber = 3201; // Start at 3201
    let periodOffset;
    let selectedNumber = null;
    let selectedColor = null;
    let selectedSize = null;
    let pendingDeposits = [];
    let pendingWithdrawals = [];
    let walletBalance = 0.51;
    let currentBet = null;
    let betHistory = [];
    let winLossHistory = [];
    let usedUTRs = new Set();
    let selectedDepositAmount = 100;

    const timerEl = document.getElementById("countdown");
    const winningResultEl = document.getElementById("winningResult");
    const historyEl = document.getElementById("historyList");
    const myBetHistoryEl = document.getElementById("myBetHistoryList");
    const periodEl = document.getElementById("period");
    const numberGrid = document.getElementById("numberGrid");
    const colorGrid = document.getElementById("colorGrid");
    const sizeGrid = document.getElementById("sizeGrid");
    const walletBalanceEl = document.getElementById("walletBalance");
    const qrCodeImageEl = document.getElementById("qrCodeImage");
    const qrErrorMessageEl = document.getElementById("qrErrorMessage");

    const TELEGRAM_BOT_TOKEN = "7930171564:AAEbqIoIGZY22cP4GxreLAWhQxD08rQOtrQ";
    const TELEGRAM_CHAT_ID = "5247395156";
    const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;

    // Generate or retrieve a device-specific period offset
    function getPeriodOffset() {
      let offset = localStorage.getItem('periodOffset');
      if (!offset) {
        offset = Math.floor(Math.random() * 1000);
        localStorage.setItem('periodOffset', offset);
      }
      return parseInt(offset);
    }

    // Initialize period offset
    periodOffset = getPeriodOffset();
    periodEl.textContent = displayPeriodNumber;

    function updateWalletBalance() {
      walletBalanceEl.textContent = `â‚¹${walletBalance.toFixed(2)}`;
    }

    const colorMap = {
      0: "mix-red-purple",
      1: "green",
      2: "red",
      3: "green",
      4: "red",
      5: "mix-green-purple",
      6: "red",
      7: "green",
      8: "red",
      9: "green"
    };

    const colors = ["Green", "Violet", "Red"];
    const colorStyles = {
      "Green": "green",
      "Violet": "purple",
      "Red": "red"
    };

    const sizes = ["Big", "Small"];

    const qrCodes = {
      100: "https://vault.pictures/media/images/87/57/5e/87575e9fdcbf4b7db2a09533d4b49900.jpg",
      200: "https://vault.pictures/media/images/8b/49/eb/8b49eb0546f141129176e35592e2e6de.jpg",
      500: "https://vault.pictures/media/images/a2/4f/32/a24f32f3cce94c57932af76c20656de8.jpg",
      1000: "https://vault.pictures/media/images/87/57/5e/87575e9fdcbf4b7db2a09533d4b49900.jpg"
    };

    // Initial game history entries (30 entries, 3 per number from 0 to 9)
    const initialGameHistory = [];
    let startDisplayPeriod = 3201 - 30; // Start at 3171
    const winningNumbers = [];
    // Cycle through 0-9 three times to get 30 entries
    for (let i = 0; i < 30; i++) {
      winningNumbers.push(i % 10); // 0, 1, 2, ..., 9, 0, 1, ..., 9, 0, 1, ..., 9
    }
    for (let i = 0; i < 30; i++) {
      const periodNum = startDisplayPeriod + i;
      const num = winningNumbers[i];
      let color, size;
      if ([0, 2, 4, 6, 8].includes(num)) {
        color = "Red";
      } else {
        color = "Green";
      }
      size = num >= 5 ? "Big" : "Small";
      initialGameHistory.push({ displayPeriod: periodNum, number: num, color, size });
    }

    function simulateImageProcessing(phoneNumber, callback) {
      const extractedPhoneNumber = phoneNumber;
      const extractedReceiverID = "nagurbasha@fam";
      const possibleAmounts = [100, 200, 500, 1000];
      const extractedAmount = possibleAmounts[Math.floor(Math.random() * possibleAmounts.length)];
      callback(extractedPhoneNumber, extractedReceiverID, extractedAmount);
    }

    function selectDepositAmount(amount) {
      selectedDepositAmount = amount;
      document.querySelectorAll(".amount-btn").forEach(btn => btn.classList.remove("selected"));
      event.target.classList.add("selected");
      qrCodeImageEl.src = qrCodes[amount];
      qrCodeImageEl.style.display = 'block';
      qrErrorMessageEl.style.display = 'none';
    }

    function sendTelegramMessage(message) {
      const timestamp = new Date().toLocaleString();
      const text = `[${timestamp}] ${message}`;
      const url = `${TELEGRAM_API_URL}?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(text)}`;

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (!data.ok) {
          console.error('Failed to send Telegram message:', data);
        }
      })
      .catch(error => {
        console.error('Error sending Telegram message:', error);
      });
    }

    for (let i = 0; i <= 9; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.classList.add("number-btn", colorMap[i]);
      btn.addEventListener("click", () => {
        if (selectedNumber === i) {
          btn.classList.remove("selected");
          selectedNumber = null;
        } else {
          document.querySelectorAll(".number-btn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedNumber = i;
        }
      });
      numberGrid.appendChild(btn);
    }

    colors.forEach(color => {
      const btn = document.createElement("button");
      btn.textContent = color;
      btn.classList.add("color-btn", color.toLowerCase());
      btn.addEventListener("click", () => {
        if (selectedColor === color) {
          btn.classList.remove("selected");
          selectedColor = null;
        } else {
          document.querySelectorAll(".color-btn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedColor = color;
        }
      });
      colorGrid.appendChild(btn);
    });

    sizes.forEach(size => {
      const btn = document.createElement("button");
      btn.textContent = size;
      btn.classList.add("size-btn", size.toLowerCase());
      btn.addEventListener("click", () => {
        if (selectedSize === size) {
          btn.classList.remove("selected");
          selectedSize = null;
        } else {
          document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedSize = size;
        }
      });
      sizeGrid.appendChild(btn);
    });

    function determineWin() {
      const totalBets = winLossHistory.length;
      const wins = winLossHistory.filter(result => result === "Win").length;
      const winRate = totalBets > 0 ? (wins / totalBets) * 100 : 0;

      if (totalBets < 10) {
        return Math.random() < 0.3;
      }

      if (winRate >= 30) {
        return false;
      } else if ((totalBets - wins) / totalBets * 100 >= 70) {
        return true;
      } else {
        return Math.random() < 0.3;
      }
    }

    setInterval(() => {
      countdown--;
      timerEl.textContent = countdown;

      if (countdown <= 0) {
        let winNum = Math.floor(Math.random() * 10);
        let winColor;
        let isDualColor = false;

        const shouldWin = currentBet ? determineWin() : true;

        if (currentBet && !shouldWin) {
          while (winNum === currentBet.number || 
                 (currentBet.color && (
                   (winNum === 0 && (currentBet.color === "Red" || currentBet.color === "Violet")) ||
                   (winNum === 5 && (currentBet.color === "Green" || currentBet.color === "Violet")) ||
                   ([1, 3, 7, 9].includes(winNum) && currentBet.color === "Green") ||
                   ([2, 4, 6, 8].includes(winNum) && currentBet.color === "Red")
                 )) ||
                 (currentBet.size && (
                   (winNum >= 5 && currentBet.size === "Big") ||
                   (winNum < 5 && currentBet.size === "Small")
                 ))) {
            winNum = Math.floor(Math.random() * 10);
          }
        }

        if ([0, 2, 4, 6, 8].includes(winNum)) {
          winColor = "Red";
          if (winNum === 0) isDualColor = true;
        } else {
          winColor = "Green";
          if (winNum === 5) isDualColor = true;
        }

        const winSize = winNum >= 5 ? "Big" : "Small";

        winningResultEl.textContent = `${winNum}, ${winColor}`;
        winningResultEl.className = "winning-box";
        if (winNum === 0) {
          winningResultEl.style.background = "linear-gradient(to right, #cc0000 50%, #9933cc 50%)";
        } else if (winNum === 5) {
          winningResultEl.style.background = "linear-gradient(to right, #009933 50%, #9933cc 50%)";
        } else if ([2, 4, 6, 8].includes(winNum)) {
          winningResultEl.style.background = "#cc0000";
        } else if ([1, 3, 7, 9].includes(winNum)) {
          winningResultEl.style.background = "#009933";
        }

        let numColor;
        if (winNum === 0) numColor = "#aa66cc";
        else if (winNum === 5) numColor = "#aa66cc";
        else if ([2, 4, 6, 8].includes(winNum)) numColor = "#cc0000";
        else numColor = "#009933";

        historyEl.innerHTML = `<li>Period <a href="javascript:void(0)" onclick="showPeriodDetails(${displayPeriodNumber}, ${winNum}, '${winColor}', '${winSize}')">${displayPeriodNumber}</a>: <span style="color:${numColor}; font-weight:bold;">${winNum}</span>, <span style="color:${colorStyles[winColor]}; font-weight:bold;">${winColor}</span>, <span style="font-weight:bold;">${winSize}</span></li>` + historyEl.innerHTML;

        if (currentBet) {
          let winnings = 0;
          let winMessages = [];
          let isWin = false;

          if (currentBet.number !== null && currentBet.number === winNum) {
            winnings += currentBet.amount * 9;
            winMessages.push(`number ${winNum} (â‚¹${(currentBet.amount * 9).toFixed(2)})`);
            isWin = true;
          }

          if (currentBet.color !== null && currentBet.color === winColor) {
            const multiplier = isDualColor ? 0.5 : 1;
            winnings += currentBet.amount * multiplier;
            winMessages.push(`color ${winColor} (â‚¹${(currentBet.amount * multiplier).toFixed(2)})`);
            isWin = true;
          }

          if (currentBet.size !== null && currentBet.size === winSize) {
            winnings += currentBet.amount * 1;
            winMessages.push(`size ${winSize} (â‚¹${(currentBet.amount * 1).toFixed(2)})`);
            isWin = true;
          }

          let betDetails = [];
          if (currentBet.number !== null) betDetails.push(`number ${currentBet.number}`);
          if (currentBet.color !== null) betDetails.push(`color ${currentBet.color}`);
          if (currentBet.size !== null) betDetails.push(`size ${currentBet.size}`);
          const betResult = isWin ? "Win" : "Loss";
          const resultColor = isWin ? "#00ff00" : "#ff0000";
          winLossHistory.push(betResult);
          betHistory.unshift({
            period: period,
            betAmount: currentBet.amount,
            betDetails: betDetails.join(" and "),
            result: betResult,
            winnings: winnings > 0 ? winnings : 0
          });
          myBetHistoryEl.innerHTML = `<li>Period ${displayPeriodNumber}: Bet â‚¹${currentBet.amount.toFixed(2)} on ${betDetails.join(" and ")} - <span style="color:${resultColor}; font-weight:bold;">${betResult}</span>${isWin ? ` (Won â‚¹${winnings.toFixed(2)})` : ''}</li>` + myBetHistoryEl.innerHTML;

          if (winnings > 0) {
            walletBalance += winnings;
            updateWalletBalance();
            alert(`Congratulations! You won on ${winMessages.join(" and ")}! Total winnings: â‚¹${winnings.toFixed(2)}. New balance: â‚¹${walletBalance.toFixed(2)}`);
          } else {
            const cashback = currentBet.amount * 0.1;
            walletBalance += cashback;
            updateWalletBalance();
            alert(`Sorry, you lost this round. A cashback of â‚¹${cashback.toFixed(2)} has been credited to your wallet. New balance: â‚¹${walletBalance.toFixed(2)}`);
          }
        }

        selectedNumber = null;
        selectedColor = null;
        selectedSize = null;
        currentBet = null;
        document.querySelectorAll(".number-btn").forEach(b => b.classList.remove("selected"));
        document.querySelectorAll(".color-btn").forEach(b => b.classList.remove("selected"));
        document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("selected"));

        period++;
        displayPeriodNumber++;
        periodEl.textContent = displayPeriodNumber;
        countdown = 60;
      }
    }, 1000);

    function placeBet() {
      const amount = parseFloat(document.getElementById("amount").value);

      if (selectedNumber === null && selectedColor === null && selectedSize === null) {
        alert("Please select a number, color, or size before placing a bet.");
        return;
      }
      if (amount < 10) {
        alert("Minimum bet amount is â‚¹10.");
        return;
      }
      if (amount > walletBalance) {
        alert("Insufficient balance to place this bet!");
        return;
      }

      currentBet = {
        number: selectedNumber,
        color: selectedColor,
        size: selectedSize,
        amount: amount
      };

      let betDetails = [];
      if (selectedNumber !== null) betDetails.push(`number ${selectedNumber}`);
      if (selectedColor !== null) betDetails.push(`color ${selectedColor}`);
      if (selectedSize !== null) betDetails.push(`size ${selectedSize}`);
      alert(`You bet â‚¹${amount} on ${betDetails.join(" and ")} (Period ${displayPeriodNumber})`);

      walletBalance -= amount;
      updateWalletBalance();
      document.getElementById("amount").value = "";
    }

    function submitDeposit() {
      const phoneNumber = document.getElementById("phoneNumber").value.trim();
      const utr = document.getElementById("depositUTR").value.trim();
      const depositProof = document.getElementById("depositProof").files[0];
      const depositStatusEl = document.getElementById("depositStatus");

      if (!phoneNumber) {
        depositStatusEl.textContent = "Please enter your phone number.";
        depositStatusEl.className = "status-message error";
        return;
      }

      if (!/^\d{10}$/.test(phoneNumber)) {
        depositStatusEl.textContent = "Please enter a valid 10-digit phone number.";
        depositStatusEl.className = "status-message error";
        return;
      }

      if (!utr) {
        depositStatusEl.textContent = "Please enter a UTR number.";
        depositStatusEl.className = "status-message error";
        return;
      }

      if (usedUTRs.has(utr)) {
        depositStatusEl.textContent = "This UTR number has already been used.";
        depositStatusEl.className = "status-message error";
        return;
      }

      if (!depositProof) {
        depositStatusEl.textContent = "Please upload a payment proof image.";
        depositStatusEl.className = "status-message error";
        return;
      }

      simulateImageProcessing(phoneNumber, (extractedPhoneNumber, extractedReceiverID, extractedAmount) => {
        if (extractedPhoneNumber !== phoneNumber) {
          depositStatusEl.textContent = "Phone number in the image does not match the entered phone number.";
          depositStatusEl.className = "status-message error";
          return;
        }

        const expectedReceiverID = "nagurbasha@fam";
        if (extractedReceiverID !== expectedReceiverID) {
          depositStatusEl.textContent = `Invalid Receiver ID in image. Expected: ${expectedReceiverID}, Found: ${extractedReceiverID}`;
          depositStatusEl.className = "status-message error";
          return;
        }

        usedUTRs.add(utr);
        pendingDeposits.push({
          utr,
          amount: extractedAmount,
          receiverID: extractedReceiverID,
          phoneNumber: phoneNumber,
          status: "Pending",
          verified: true
        });

        sendTelegramMessage(`Deposit Request: UTR ${utr}, Amount â‚¹${extractedAmount}, Phone: ${phoneNumber}, Receiver ID: ${extractedReceiverID}`);

        walletBalance += extractedAmount;
        updateWalletBalance();

        depositStatusEl.textContent = `Deposit of â‚¹${extractedAmount} with UTR ${utr} verified successfully! Amount added to balance: â‚¹${walletBalance.toFixed(2)}`;
        depositStatusEl.className = "status-message success";

        setTimeout(() => {
          alert(`Deposit of â‚¹${extractedAmount} with UTR ${utr} processed successfully! New balance: â‚¹${walletBalance.toFixed(2)}`);
          hideForms();
          document.getElementById("phoneNumber").value = "";
          document.getElementById("depositUTR").value = "";
          document.getElementById("depositProof").value = "";
          depositStatusEl.textContent = "";
          selectedDepositAmount = 100;
          qrCodeImageEl.src = qrCodes[100];
          document.querySelectorAll(".amount-btn").forEach(btn => btn.classList.remove("selected"));
          document.querySelector(".amount-btn[onclick='selectDepositAmount(100)']").classList.add("selected");
        }, 2000);
      });
    }

    function submitWithdraw() {
      const bankName = document.getElementById("bankName").value.trim();
      const accountNumber = document.getElementById("accountNumber").value.trim();
      const ifscCode = document.getElementById("ifscCode").value.trim();
      const amount = parseFloat(document.getElementById("withdrawAmount").value);

      if (!bankName || !accountNumber || !ifscCode) {
        alert("Please fill in all fields.");
        return;
      }

      if (isNaN(amount) || amount < 200) {
        alert("Withdrawal amount must be at least â‚¹200.");
        return;
      }

      pendingWithdrawals.push({
        bankName,
        accountNumber,
        ifscCode,
        amount,
        status: "Pending"
      });

      sendTelegramMessage(`Withdrawal Request: Amount â‚¹${amount}, Bank: ${bankName}, A/c: ${accountNumber}, IFSC: ${ifscCode}`);

      alert(`Withdrawal request of â‚¹${amount} submitted for review!`);
      hideForms();
      document.getElementById("bankName").value = "";
      document.getElementById("accountNumber").value = "";
      document.getElementById("ifscCode").value = "";
      document.getElementById("withdrawAmount").value = "";
    }

    function promptOperatorPanel() {
      const password = prompt("Enter password:");
      if (password === "basha123") {
        showOperatorPanel();
      } else {
        alert("Incorrect password!");
      }
    }

    function showOperatorPanel() {
      let operatorPanel = document.getElementById("operatorPanel");
      if (operatorPanel) operatorPanel.remove();

      operatorPanel = document.createElement("div");
      operatorPanel.className = "operator-panel";
      operatorPanel.id = "operatorPanel";
      operatorPanel.innerHTML = `
        <h3>Control Panel</h3>
        <p>Current Period: <span id="currentPeriod">${displayPeriodNumber}</span></p>
        <p>Wallet Balance: â‚¹${walletBalance.toFixed(2)}</p>
        <h4>Pending Deposits</h4>
        <ul id="pendingDepositsList"></ul>
        <h4>Pending Withdrawals</h4>
        <ul id="pendingWithdrawalsList"></ul>
        <button onclick="resetGame()">Reset Game</button><br>
        <button class="close-btn" onclick="closeOperatorPanel()">Close</button>
      `;
      document.body.appendChild(operatorPanel);

      updatePendingDepositsList();
      updatePendingWithdrawalsList();
    }

    function updatePendingDepositsList() {
      const pendingList = document.getElementById("pendingDepositsList");
      if (!pendingList) return;

      pendingList.innerHTML = "";
      pendingDeposits.forEach((deposit, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          UTR: ${deposit.utr} (â‚¹${deposit.amount}) - Phone: ${deposit.phoneNumber} - Receiver ID: ${deposit.receiverID} - Status: ${deposit.status} - Verified: ${deposit.verified ? "Yes" : "No"}
          <button onclick="acceptDeposit(${index})">Accept</button>
        `;
        pendingList.appendChild(li);
      });
    }

    function updatePendingWithdrawalsList() {
      const pendingList = document.getElementById("pendingWithdrawalsList");
      if (!pendingList) return;

      pendingList.innerHTML = "";
      pendingWithdrawals.forEach((withdrawal, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          Bank: ${withdrawal.bankName}, A/c: ${withdrawal.accountNumber}, IFSC: ${withdrawal.ifscCode}, Amount: â‚¹${withdrawal.amount} - Status: ${withdrawal.status}
          <button onclick="acceptWithdrawal(${index})">Accept</button>
        `;
        pendingList.appendChild(li);
      });
    }

    function acceptDeposit(index) {
      const deposit = pendingDeposits[index];
      if (!deposit.verified) {
        alert("Deposit not verified!");
        return;
      }
      deposit.status = "Accepted";
      alert(`Deposit with UTR ${deposit.utr} (â‚¹${deposit.amount}) already processed!`);
      updatePendingDepositsList();
    }

    function acceptWithdrawal(index) {
      const withdrawal = pendingWithdrawals[index];
      if (walletBalance < withdrawal.amount) {
        alert("Insufficient balance to process this withdrawal!");
        return;
      }
      withdrawal.status = "Accepted";
      walletBalance -= withdrawal.amount;
      updateWalletBalance();
      alert(`Withdrawal of â‚¹${withdrawal.amount} to ${withdrawal.bankName} (A/c: ${withdrawal.accountNumber}) accepted! Balance updated: â‚¹${walletBalance.toFixed(2)}`);
      updatePendingWithdrawalsList();
    }

    function closeOperatorPanel() {
      const operatorPanel = document.getElementById("operatorPanel");
      if (operatorPanel) operatorPanel.remove();
    }

    function resetGame() {
      countdown = 60;
      period = 20250501100030100;
      displayPeriodNumber = 3201;
      selectedNumber = null;
      selectedColor = null;
      selectedSize = null;
      currentBet = null;
      betHistory = [];
      winLossHistory = [];
      timerEl.textContent = countdown;
      periodEl.textContent = displayPeriodNumber;
      const currentPeriodEl = document.getElementById("currentPeriod");
      if (currentPeriodEl) currentPeriodEl.textContent = displayPeriodNumber;
      winningResultEl.textContent = "--";
      winningResultEl.style.background = "#444";
      historyEl.innerHTML = "";
      myBetHistoryEl.innerHTML = "";
      document.querySelectorAll(".number-btn").forEach(b => b.classList.remove("selected"));
      document.querySelectorAll(".color-btn").forEach(b => b.classList.remove("selected"));
      document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("selected"));
      // Re-populate initial game history after reset
      initialGameHistory.forEach(entry => {
        let numColor;
        if (entry.number === 0 || entry.number === 5) numColor = "#aa66cc";
        else if ([2, 4, 6, 8].includes(entry.number)) numColor = "#cc0000";
        else numColor = "#009933";
        historyEl.innerHTML += `<li>Period <a href="javascript:void(0)" onclick="showPeriodDetails(${entry.displayPeriod}, ${entry.number}, '${entry.color}', '${entry.size}')">${entry.displayPeriod}</a>: <span style="color:${numColor}; font-weight:bold;">${entry.number}</span>, <span style="color:${colorStyles[entry.color]}; font-weight:bold;">${entry.color}</span>, <span style="font-weight:bold;">${entry.size}</span></li>`;
      });
      alert("Game has been reset!");
    }

    // Populate initial game history on load
    initialGameHistory.forEach(entry => {
      let numColor;
      if (entry.number === 0 || entry.number === 5) numColor = "#aa66cc";
      else if ([2, 4, 6, 8].includes(entry.number)) numColor = "#cc0000";
      else numColor = "#009933";
      historyEl.innerHTML += `<li>Period <a href="javascript:void(0)" onclick="showPeriodDetails(${entry.displayPeriod}, ${entry.number}, '${entry.color}', '${entry.size}')">${entry.displayPeriod}</a>: <span style="color:${numColor}; font-weight:bold;">${entry.number}</span>, <span style="color:${colorStyles[entry.color]}; font-weight:bold;">${entry.color}</span>, <span style="font-weight:bold;">${entry.size}</span></li>`;
    });

    updateWalletBalance();
  </script>
</body>
</html>
