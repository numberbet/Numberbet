<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UTR Number Collection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: white;
    }

    .winning-number-box {
      width: 200px;
      height: 200px;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 40px;
      font-size: 60px;
      font-weight: bold;
      color: transparent;
      border-radius: 10px;
      border: 2px solid #ff006e;
      box-shadow: 0 0 20px 5px #ff006e, 0 0 30px 5px #ff006e;
      animation: blink 1.5s infinite alternate;
    }

    .winning-number {
      color: #ff006e;
      text-shadow: 0 0 10px #ff006e, 0 0 20px #ff006e, 0 0 30px #ff006e;
    }

    .winner-name-box {
      font-size: 24px;
      margin-top: 10px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }

    .timer-box {
      text-align: center;
      margin-top: 10px;
      font-size: 20px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 10px;
    }

    .current-time-box {
      text-align: center;
      margin-top: 10px;
      font-size: 18px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 8px;
      border-radius: 10px;
    }

    @keyframes blink {
      0% {
        text-shadow: 0 0 10px #ff006e, 0 0 20px #ff006e, 0 0 30px #ff006e;
        opacity: 1;
      }
      100 offend {
        text-shadow: 0 0 20px #ff006e, 0 0 30px #ff006e, 0 0 40px #ff006e;
        opacity: 0.5;
      }
    }

    .number-container {
      display: flex;
      gap: 10px;
      margin: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .number-btn {
      background: white;
      color: #2575fc;
      font-size: 18px;
      font-weight: bold;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .number-btn:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    #buyForm {
      display: none;
      margin-top: 20px;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }

    .back-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .buy-info {
      margin-bottom: 15px;
      text-align: center;
    }

    .buy-info img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .list-btns {
      margin-top: 30px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .toggle-btn {
      background: #00ffcc;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }

    .list-btn-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .list-container {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
      max-height: 200px;
      overflow-y: auto;
      width: 150px;
      display: none;
    }

    .list-container ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .list-container li {
      background: rgba(0, 0, 0, 0.3);
      margin: 5px 0;
      padding: 5px;
      border-radius: 5px;
      font-size: 14px;
    }

    .loader {
      display: none;
      margin-top: 10px;
      color: red;
    }

    input[type="text"], input[type="file"] {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-weight: bold;
    }

    #uploadedImage {
      max-width: 100%;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="winning-number-box">
    <div class="winning-number" id="winningNumber"></div>
  </div>

  <div class="winner-name-box" id="winnerName" style="display:none"></div>

  <div class="timer-box" id="timer">üïí Open Time: 05:45:00 PM</div>
  <div class="current-time-box" id="currentTime">üïí Current Time: --:--:-- --</div>

  <div class="number-container">
    <button class="number-btn" onclick="selectNumber('05')">05</button>
    <button class="number-btn" onclick="selectNumber('16')">16</button>
    <button class="number-btn" onclick="selectNumber('27')">27</button>
    <button class="number-btn" onclick="selectNumber('38')">38</button>
    <button class="number-btn" onclick="selectNumber('49')">49</button>
  </div>

  <div id="buyForm">
    <button class="back-btn" onclick="goBack()">‚Üê Back</button>

    <div class="buy-info">
      <img src="https://vault.pictures/media/images/b9/0e/a8/b90ea8a2240645509bb68a7ba006940c.jpg" alt="Payment Info" />
      <p>Please make the payment and upload the screenshot. Then fill in your details below.</p>
    </div>

    <h3>Buy Form</h3>
    <p>Selected Number: <span id="selectedNumber"></span></p>
    <input type="text" id="whatsappInput" placeholder="Enter WhatsApp Number" />
    <input type="text" id="nameInput" placeholder="Enter Full Name" />
    <input type="text" id="phonepeInput" placeholder="Enter PhonePe Number" />
    <input type="text" id="utrInput" placeholder="UTR Number (Auto)" readonly />
    <div id="utrTimestamp"></div>
    <input type="file" id="imageUpload" accept="image/*" onchange="extractUTRFromImage()" />
    <button onclick="submitForm()">Submit</button>
    <div id="loader" class="loader">Detecting UTR Number...</div>
    <img id="uploadedImage" src="" alt="Uploaded Image" />
  </div>

  <div class="list-btns">
    <button class="toggle-btn" onclick="toggleList('buyersList')">Buyers List</button>
    <button class="toggle-btn" onclick="toggleList('winnersList')">Winners List</button>
  </div>

  <div class="list-btn-container">
    <div class="list-container" id="buyersList">
      <ul id="buyers">
        <li>0000</li>
        <li>0000</li>
         <li>0000</li>
        <li>0000</li>
         <li> 0000 </li>
      </ul>
    </div>
    <div class="list-container" id="winnersList">
      <ul id="winners">
        <li>ABDUL - 49</li>
      </ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <script>
    const telegramToken = "7930171564:AAEbqIoIGZY22cP4GxreLAWhQxD08rQOtrQ";
    const telegramChatId = "5247395156";

    const winningNumberValue = "49";
    const winnerNameValue = "ABDUL";

    document.getElementById("winningNumber").textContent = "";
    document.getElementById("winnerName").style.display = "none";

    // Set Open Time (manually fixed)
    const openTime = "05:45:00 PM";

    function formatISTTime() {
      const now = new Date();
      const istOffset = 5.5 * 60 * 60 * 1000; // IST: UTC +5:30
      const istTime = new Date(now.getTime() + istOffset);
      
      let hours = istTime.getUTCHours();
      const minutes = String(istTime.getUTCMinutes()).padStart(2, '0');
      const seconds = String(istTime.getUTCSeconds()).padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      
      hours = hours % 12;
      hours = hours ? hours : 12;
      hours = String(hours).padStart(2, '0');
      
      return `${hours}:${minutes}:${seconds} ${ampm}`;
    }

    function parseTimeToSeconds(timeStr) {
      const [time, period] = timeStr.split(' ');
      let [hours, minutes, seconds] = time.split(':').map(Number);
      
      if (period === 'PM' && hours !== 12) hours += 12;
      if (period === 'AM' && hours === 12) hours = 0;
      
      return hours * 3600 + minutes * 60 + seconds;
    }

    let isWinnerDisplayed = false;

    function updateTimer() {
      if (isWinnerDisplayed) return;

      // Update Open Time display
      const timerDisplay = document.getElementById("timer");
      timerDisplay.textContent = `üïí Open Time: ${openTime}`;

      // Update Current Time
      const currentTimeDisplay = document.getElementById("currentTime");
      const currentTime = formatISTTime();
      currentTimeDisplay.textContent = `üïí Current Time: ${currentTime}`;

      // Check if current time matches or exceeds open time
      const currentSeconds = parseTimeToSeconds(currentTime);
      const openSeconds = parseTimeToSeconds(openTime);

      if (currentSeconds >= openSeconds) {
        isWinnerDisplayed = true;
        
        // Display winning number and winner name
        const winningNumberBox = document.querySelector(".winning-number-box");
        const winningNumberElement = document.getElementById("winningNumber");
        const winnerNameElement = document.getElementById("winnerName");

        winningNumberElement.textContent = winningNumberValue;
        winnerNameElement.textContent = `üèÜ Winner: ${winnerNameValue}`;
        winnerNameElement.style.display = "block";

        // Keep the blinking animation, change border and shadow to green
        winningNumberBox.style.boxShadow = "0 0 20px 5px #00ffcc, 0 0 30px 5px #00ffcc";
        winningNumberBox.style.borderColor = "#00ffcc";

        // Disable number selection buttons
        document.querySelectorAll(".number-btn").forEach(button => {
          button.disabled = true;
        });

        console.log("Winner displayed:", winningNumberValue, winnerNameValue);
      }
    }

    // Run timer every second
    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer();

    function selectNumber(num) {
      if (isWinnerDisplayed) {
        alert("The game has ended. No more selections allowed.");
        return;
      }
      document.getElementById('selectedNumber').textContent = num;
      document.getElementById('buyForm').style.display = 'block';
      document.querySelector('.number-container').style.display = 'none';
    }

    function goBack() {
      document.getElementById('buyForm').style.display = 'none';
      document.querySelector('.number-container').style.display = 'flex';
    }

    function toggleList(id) {
      const list = document.getElementById(id);
      list.style.display = list.style.display === 'none' ? 'block' : 'none';
    }

    function extractUTRFromImage() {
      const imageInput = document.getElementById('imageUpload');
      const utrInput = document.getElementById('utrInput');
      const timestamp = document.getElementById('utrTimestamp');
      const loader = document.getElementById('loader');

      const file = imageInput.files[0];
      if (!file) return;

      loader.style.display = 'block';

      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        document.getElementById('uploadedImage').style.display = 'none';

        Tesseract.recognize(
          imageData, 'eng',
          { logger: m => console.log(m) }
        ).then(({ data: { text } }) => {
          const match = text.match(/\b\d{10,14}\b/);
          if (match) {
            const utr = match[0];
            utrInput.value = utr;
            const now = new Date();
            timestamp.textContent = "Collected at: " + now.toLocaleTimeString();
          } else {
            alert("No valid UTR number found in the image.");
          }
        }).catch(err => {
          console.error(err);
          alert("Error reading image.");
        }).finally(() => {
          loader.style.display = 'none';
        });
      };
      reader.readAsDataURL(file);
    }

    async function submitForm() {
      const whatsapp = document.getElementById('whatsappInput').value;
       name = document.getElementById('nameInput').value;
      const phonepe = document.getElementById('phonepeInput').value;
      const utr = document.getElementById('utrInput').value;
      const selected = document.getElementById('selectedNumber').textContent;
      const imageInput = document.getElementById('imageUpload');
      const file = imageInput.files[0];

      if (!whatsapp || !name || !phonepe || !utr || !selected || !file) {
        alert("Please fill all fields and upload an image.");
        return;
      }

      const message = `üìù New Form Submission:\nüë§ Name: ${name}\nüì± WhatsApp: ${whatsapp}\nüí∏ PhonePe: ${phonepe}\nüéØ Selected Number: ${selected}\nüî¢ UTR: ${utr}`;

      try {
        // Prepare FormData for sending the image
        const formData = new FormData();
        formData.append('chat_id', telegramChatId);
        formData.append('photo', file);
        formData.append('caption', message);

        // Send the image with caption
        const photoResponse = await fetch(`https://api.telegram.org/bot${telegramToken}/sendPhoto`, {
          method: 'POST',
          body: formData
        });

        if (!photoResponse.ok) {
          throw new Error('Failed to send photo');
        }

        alert("Form and image submitted successfully!");
      } catch (err) {
        console.error(err);
        alert("Error submitting form or image. Please try again.");
      }
    }
  </script>
</body>
</html>
